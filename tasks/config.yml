- name: Update SSH configuration to be more secure
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    backrefs: yes
    validate: 'sshd -f %s -T'
  become: true
  with_items:
    - regexp: "^HostKey /etc/ssh/ssh_host_dsa_key"
      line: "#HostKey /etc/ssh/ssh_host_dsa_key"
    - regexp: "^HostKey /etc/ssh/ssh_host_ecdsa_key"
      line: "#HostKey /etc/ssh/ssh_host_ecdsa_key"
    - regexp: "^#HostKey /etc/ssh/ssh_host_rsa_key"
      line: "HostKey /etc/ssh/ssh_host_rsa_key"
    - regexp: "^#HostKey /etc/ssh/ssh_host_ed25519_key"
      line: "HostKey /etc/ssh/ssh_host_ed25519_key"
    - regexp: "^#?PermitRootLogin"
      line: "PermitRootLogin no"
  notify:
    - restart sshd
